{% extends "base.html" %}

{% block title %}Edit Class - LMS{% endblock %}

{% block content %}
<div class="page-header">
    <div class="header-content">
        <h1 class="page-title">
            <i class="fas fa-edit"></i>
            Edit Class
        </h1>
        <div class="header-actions">
            <a href="{{ url_for('view_class', id=class.id) }}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i>
                Back to Class
            </a>
        </div>
    </div>
</div>

<div class="class-edit-container">
    <form method="POST" action="{{ url_for('edit_class', id=class.id) }}" class="class-form">
        <div class="form-grid">
            <!-- Status Section -->
            <div class="form-section">
                <h3><i class="fas fa-info-circle"></i> Class Status</h3>
                
                <div class="current-status">
                    <span class="status-badge status-{{ class.status }}">
                        Current Status: {{ class.status.replace('_', ' ').title() }}
                    </span>
                </div>
                
                {% if class.status in ['scheduled', 'in_progress'] %}
                <div class="form-group">
                    <label for="status" class="form-label">Update Status</label>
                    <select class="form-control" id="status" name="status">
                        <option value="scheduled" {% if class.status == 'scheduled' %}selected{% endif %}>Scheduled</option>
                        <option value="in_progress" {% if class.status == 'in_progress' %}selected{% endif %}>In Progress</option>
                        <option value="completed" {% if class.status == 'completed' %}selected{% endif %}>Completed</option>
                        <option value="cancelled" {% if class.status == 'cancelled' %}selected{% endif %}>Cancelled</option>
                    </select>
                </div>
                {% endif %}
            </div>
            
            <!-- Basic Information -->
            <div class="form-section">
                <h3><i class="fas fa-book"></i> Basic Information</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="subject" class="form-label required">Subject</label>
                        <input type="text" class="form-control" id="subject" name="subject" 
                               value="{{ class.subject or '' }}" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="topic_covered" class="form-label">Topic</label>
                        <input type="text" class="form-control" id="topic_covered" name="topic_covered" 
                               value="{{ class.topic_covered or '' }}">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="class_notes" class="form-label">Class Notes</label>
                    <textarea class="form-control" id="class_notes" name="class_notes" rows="3">{{ class.class_notes or '' }}</textarea>
                </div>
                
                <div class="form-group">
                    <label for="homework_assigned" class="form-label">Homework Assigned</label>
                    <textarea class="form-control" id="homework_assigned" name="homework_assigned" rows="2">{{ class.homework_assigned or '' }}</textarea>
                </div>
            </div>
            
            <!-- Schedule -->
            <div class="form-section">
                <h3><i class="fas fa-calendar-alt"></i> Schedule</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="class_date" class="form-label required">Date</label>
                        <input type="date" class="form-control" id="class_date" name="class_date" 
                               value="{{ class.class_date.strftime('%Y-%m-%d') if class.class_date else '' }}" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="start_time" class="form-label required">Start Time</label>
                        <input type="time" class="form-control" id="start_time" name="start_time" 
                               value="{{ class.start_time.strftime('%H:%M') if class.start_time else '' }}" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="end_time" class="form-label required">End Time</label>
                        <input type="time" class="form-control" id="end_time" name="end_time" 
                               value="{{ class.end_time.strftime('%H:%M') if class.end_time else '' }}" required>
                    </div>
                </div>
            </div>
            
            <!-- Meeting Information -->
            <div class="form-section">
                <h3><i class="fas fa-video"></i> Meeting Information</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="meeting_link" class="form-label">Meeting Link</label>
                        <input type="url" class="form-control" id="meeting_link" name="meeting_link" 
                               value="{{ class.meeting_link or '' }}">
                    </div>
                    
                    <div class="form-group">
                        <label for="meeting_id" class="form-label">Meeting ID</label>
                        <input type="text" class="form-control" id="meeting_id" name="meeting_id" 
                               value="{{ class.meeting_id or '' }}">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="meeting_password" class="form-label">Meeting Password</label>
                    <input type="text" class="form-control" id="meeting_password" name="meeting_password" 
                           value="{{ class.meeting_password or '' }}">
                </div>
                
                <div class="form-group">
                    <label for="recording_link" class="form-label">Recording Link</label>
                    <input type="url" class="form-control" id="recording_link" name="recording_link" 
                           value="{{ class.recording_link or '' }}" 
                           placeholder="Link to class recording">
                </div>
            </div>
        </div>
        
        <!-- Form Actions -->
        <div class="form-actions">
            <button type="submit" class="btn btn-primary btn-lg">
                <i class="fas fa-save"></i>
                Save Changes
            </button>
            <a href="{{ url_for('view_class', id=class.id) }}" class="btn btn-secondary btn-lg">
                <i class="fas fa-times"></i>
                Cancel
            </a>
            {% if class.status == 'scheduled' %}
            <button type="button" class="btn btn-danger btn-lg" onclick="confirmDelete()">
                <i class="fas fa-trash"></i>
                Delete Class
            </button>
            {% endif %}
        </div>
    </form>
</div>

<style>
.class-edit-container {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
}

.current-status {
    margin-bottom: 20px;
    padding: 16px;
    background: #f8f9fa;
    border-radius: 8px;
    border-left: 4px solid #F1A150;
}

.form-actions .btn-danger {
    margin-left: auto;
}
</style>

<script>
function confirmDelete() {
    if (confirm('Are you sure you want to delete this class? This action cannot be undone.')) {
        fetch(`/classes/{{ class.id }}/delete`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                window.location.href = '{{ url_for("classes") }}';
            } else {
                alert('Error: ' + data.message);
            }
        });
    }
}
</script>
{% endblock %}